-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;

DROP TABLE IF EXISTS material_type;

DROP TABLE IF EXISTS product_type CASCADE;

DROP TABLE IF EXISTS partners CASCADE;

DROP TABLE IF EXISTS products CASCADE;

DROP TABLE IF EXISTS partner_products CASCADE;

DROP TYPE IF EXISTS organization_type CASCADE;

CREATE TYPE public.organization_type AS ENUM ('ЗАО', 'ОАО', 'ООО', 'ПАО');

CREATE TABLE
    public.material_type (
        id bigserial NOT NULL,
        name character varying(100) NOT NULL UNIQUE,
        defect_rate double precision NOT NULL,
        CONSTRAINT material_type_pkey PRIMARY KEY (id)
    );

CREATE TABLE
    public.partner_products (
        id bigserial NOT NULL,
        product_id bigint NOT NULL,
        partner_id bigint NOT NULL,
        product_quantity bigint NOT NULL,
        sell_date date NOT NULL,
        CONSTRAINT partner_products_pkey PRIMARY KEY (id)
    );

CREATE TABLE
    public.partners (
        id bigserial NOT NULL,
        name character varying(100) NOT NULL UNIQUE,
        type organization_type NOT NULL,
        email character varying(100) NOT NULL,
        phone character varying(20) NOT NULL,
        address text NOT NULL,
        tin bigint NOT NULL,
        rating smallint NOT NULL,
        director character varying(100) NOT NULL,
        CONSTRAINT partners_pkey PRIMARY KEY (id)
    );

CREATE TABLE
    public.product_type (
        id bigserial NOT NULL,
        name text NOT NULL UNIQUE,
        ratio double precision NOT NULL,
        CONSTRAINT product_type_pkey PRIMARY KEY (id)
    );

CREATE TABLE
    public.products (
        id bigserial NOT NULL,
        name text NOT NULL UNIQUE,
        product_type_id bigint NOT NULL,
        article bigint NOT NULL,
        min_price double precision NOT NULL,
        CONSTRAINT products_pkey PRIMARY KEY (id)
    );

ALTER TABLE IF EXISTS public.partner_products
ADD CONSTRAINT partner_products_partner_id_fkey FOREIGN KEY (partner_id) REFERENCES public.partners (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE IF EXISTS public.partner_products
ADD CONSTRAINT partner_products_produckt_id_fkey FOREIGN KEY (product_id) REFERENCES public.products (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE CASCADE NOT VALID;

ALTER TABLE IF EXISTS public.products
ADD CONSTRAINT product_type_id FOREIGN KEY (product_type_id) REFERENCES public.product_type (id) MATCH SIMPLE ON UPDATE NO ACTION ON DELETE CASCADE NOT VALID;

END;

TRUNCATE material_type;

TRUNCATE product_type CASCADE;

TRUNCATE products CASCADE;

TRUNCATE partners CASCADE;

TRUNCATE partner_products;

INSERT INTO
    material_type (id, name, defect_rate)
VALUES
    (1, 'Тип материала 1', 0.0010),
    (2, 'Тип материала 2', 0.0095),
    (3, 'Тип материала 3', 0.0028),
    (4, 'Тип материала 4', 0.0055),
    (5, 'Тип материала 5', 0.0034);

SELECT
    setval ('material_type_id_seq', 5);

INSERT INTO
    product_type (id, name, ratio)
VALUES
    (1, 'Ламинат', 2.35),
    (2, 'Массивная доска', 5.15),
    (3, 'Паркетная доска', 4.34),
    (4, 'Пробковое покрытие', 1.5);

SELECT
    setval ('product_type_id_seq', 4);

INSERT INTO
    products (id, name, product_type_id, article, min_price)
VALUES
    (
        1,
        'Паркетная доска Ясень темный однополосная 14 мм',
        3,
        8758385,
        4456.90
    ),
    (
        2,
        'Инженерная доска Дуб Французская елка однополосная 12 мм',
        3,
        8858958,
        7330.99
    ),
    (
        3,
        'Ламинат Дуб дымчато - белый 33 класс 12 мм',
        1,
        7750282,
        1799.33
    ),
    (
        4,
        'Ламинат Дуб серый 32 класс 8 мм с фаской',
        1,
        7028748,
        3890.41
    ),
    (
        5,
        'Пробковое напольное клеевое покрытие 32 класс 4 мм',
        4,
        5012543,
        5450.59
    );

SELECT
    setval ('products_id_seq', 5);

INSERT INTO
    partners (
        id,
        name,
        type,
        director,
        email,
        phone,
        address,
        tin,
        rating
    )
VALUES
    (
        1,
        'База Строитель',
        'ЗАО',
        'Иванова Александра Ивановна',
        'aleksandraivanova@ml.ru',
        '493 123 45 67',
        '652050, Кемеровская область, город Юрга, ул. Лесная, 15',
        2222455179,
        7
    ),
    (
        2,
        'Паркет 29',
        'ООО',
        'Петров Василий Петрович',
        'vppetrov@vl.ru',
        '987 123 56 78',
        '164500, Архангельская область, город Северодвинск, ул. Строителей, 18',
        3333888520,
        7
    ),
    (
        3,
        'Стройсервис',
        'ПАО',
        'Соловьев Андрей Николаевич',
        'ansolovev@st.ru',
        '812 223 32 00',
        '188910, Ленинградская область, город Приморск, ул. Парковая, 21',
        4440391035,
        7
    ),
    (
        4,
        'Ремонт и отделка',
        'ОАО',
        'Воробьева Екатерина Валерьевна',
        'ekaterina.vorobeva@ml.ru',
        '444 222 33 11',
        '143960, Московская область, город Реутов, ул. Свободы, 51',
        1111520857,
        5
    ),
    (
        5,
        'МонтажПро',
        'ЗАО',
        'Степанов Степан Сергеевич',
        'stepanov@stepan.ru',
        '912 888 33 33',
        '309500, Белгородская область, город Старый Оскол, ул. Рабочая, 122',
        5552431140,
        10
    );

SELECT
    setval ('partners_id_seq', 5);

INSERT INTO
    partner_products (
        id,
        product_id,
        partner_id,
        product_quantity,
        sell_date
    )
VALUES
    (1, 1, 1, 15500, '23.03.2023'),
    (2, 3, 1, 12350, '18.12.2023'),
    (3, 4, 1, 37400, '07.06.2024'),
    (4, 2, 2, 35000, '02.12.2022'),
    (5, 5, 2, 1250, '17.05.2023'),
    (6, 3, 2, 1000, '07.06.2024'),
    (7, 1, 2, 7550, '01.07.2024'),
    (8, 1, 3, 7250, '22.01.2023'),
    (9, 2, 3, 2500, '05.07.2024'),
    (10, 4, 4, 59050, '20.03.2023'),
    (11, 3, 4, 37200, '12.03.2024'),
    (12, 5, 4, 4500, '14.05.2024'),
    (13, 3, 5, 50000, '19.09.2023'),
    (14, 4, 5, 670000, '10.11.2023'),
    (15, 1, 5, 35000, '15.04.2024'),
    (16, 2, 5, 25000, '12.06.2024');

SELECT
    setval ('partner_products_id_seq', 16);